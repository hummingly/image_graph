(()=>{"use strict";var t={};t.m={},t.u=t=>t+".index.js",t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),t.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var n=t.g.document;if(!e&&n&&(n.currentScript&&(e=n.currentScript.src),!e)){var s=n.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=document.baseURI||self.location.href;class e{constructor(t){null==t&&(t=+new Date);let e=4022871197;function n(t){t=String(t);for(let n=0;n<t.length;n++){e+=t.charCodeAt(n);let s=.02519603282416938*e;e=s>>>0,s-=e,s*=e,e=s>>>0,s-=e,e+=4294967296*s}return 2.3283064365386963e-10*(e>>>0)}this.c=1,this.s0=n(" "),this.s1=n(" "),this.s2=n(" "),this.s0-=n(t),this.s0<0&&(this.s0+=1),this.s1-=n(t),this.s1<0&&(this.s1+=1),this.s2-=n(t),this.s2<0&&(this.s2+=1)}next(){let{c:t,s0:e,s1:n,s2:s}=this,r=2091639*e+2.3283064365386963e-10*t;return this.s0=n,this.s1=s,this.s2=r-(this.c=0|r)}copy(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}}class n{constructor(t){this.size=0,this.front=0,this.items=new Uint32Array(t),this.rear=t-1}enqueue(t){this.rear=(this.rear+1)%this.items.length,this.items[this.rear]=t,this.size+=1}dequeue(){if(0===this.size)return;const t=this.items[this.front];return this.front=(this.front+1)%this.items.length,this.size-=1,t}clear(){this.size=0,this.front=0,this.rear=this.items.length-1}}class s{constructor(t,e,n,s){this.index=new Map;for(let e=0;e<t.length;e++)this.index.set(t[e].id,e);this.nodes=t,this.imageData=s,this.adjacencyList=e,this.subGraph=n,this.edges=[];const a=n.map((t=>this.index.get(t))),o=new Set(a),i=new Set;for(const t of o){i.add(t);for(const e of this.adjacencyList[t])o.has(e)&&!i.has(e)&&(i.add(e),this.edges.push(new r(t,e)))}}sendGraphData(){return{index:this.index,nodeCount:this.nodes.length,adjacencyList:this.adjacencyList,subGraph:this.subGraph}}}class r{constructor(t,e){this.u=t,this.v=e}}class a{constructor(t,e){this.state=0,this.id=t,this.imageData=e}}function o(t,e){return fetch(`https://pixabay.com/api/?key=20367113-a073301e7fe873963664d26f9&category=nature&image_type=photo&page=${t}$&per_page=${e}`)}const i=Symbol("Comlink.proxy"),c=Symbol("Comlink.endpoint"),l=Symbol("Comlink.releaseProxy"),u=Symbol("Comlink.thrown"),h=t=>"object"==typeof t&&null!==t||"function"==typeof t,d=new Map([["proxy",{canHandle:t=>h(t)&&t[i],serialize(t){const{port1:e,port2:n}=new MessageChannel;return p(t,e),[n,[n]]},deserialize:t=>(t.start(),f(t))}],["throw",{canHandle:t=>h(t)&&u in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function p(t,e=self){e.addEventListener("message",(function n(s){if(!s||!s.data)return;const{id:r,type:a,path:o}=Object.assign({path:[]},s.data),c=(s.data.argumentList||[]).map(L);let l;try{const e=o.slice(0,-1).reduce(((t,e)=>t[e]),t),n=o.reduce(((t,e)=>t[e]),t);switch(a){case 0:l=n;break;case 1:e[o.slice(-1)[0]]=L(s.data.value),l=!0;break;case 2:l=n.apply(e,c);break;case 3:l=function(t){return Object.assign(t,{[i]:!0})}(new n(...c));break;case 4:{const{port1:e,port2:n}=new MessageChannel;p(t,n),l=function(t,e){return b.set(t,e),t}(e,[e])}break;case 5:l=void 0}}catch(t){l={value:t,[u]:0}}Promise.resolve(l).catch((t=>({value:t,[u]:0}))).then((t=>{const[s,o]=v(t);e.postMessage(Object.assign(Object.assign({},s),{id:r}),o),5===a&&(e.removeEventListener("message",n),m(e))}))})),e.start&&e.start()}function m(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function f(t,e){return w(t,[],e)}function g(t){if(t)throw new Error("Proxy has been released and is not useable")}function w(t,e=[],n=function(){}){let s=!1;const r=new Proxy(n,{get(n,a){if(g(s),a===l)return()=>S(t,{type:5,path:e.map((t=>t.toString()))}).then((()=>{m(t),s=!0}));if("then"===a){if(0===e.length)return{then:()=>r};const n=S(t,{type:0,path:e.map((t=>t.toString()))}).then(L);return n.then.bind(n)}return w(t,[...e,a])},set(n,r,a){g(s);const[o,i]=v(a);return S(t,{type:1,path:[...e,r].map((t=>t.toString())),value:o},i).then(L)},apply(n,r,a){g(s);const o=e[e.length-1];if(o===c)return S(t,{type:4}).then(L);if("bind"===o)return w(t,e.slice(0,-1));const[i,l]=y(a);return S(t,{type:2,path:e.map((t=>t.toString())),argumentList:i},l).then(L)},construct(n,r){g(s);const[a,o]=y(r);return S(t,{type:3,path:e.map((t=>t.toString())),argumentList:a},o).then(L)}});return r}function y(t){const e=t.map(v);return[e.map((t=>t[0])),(n=e.map((t=>t[1])),Array.prototype.concat.apply([],n))];var n}const b=new WeakMap;function v(t){for(const[e,n]of d)if(n.canHandle(t)){const[s,r]=n.serialize(t);return[{type:3,name:e,value:s},r]}return[{type:0,value:t},b.get(t)||[]]}function L(t){switch(t.type){case 3:return d.get(t.name).deserialize(t.value);case 0:return t.value}}function S(t,e,n){return new Promise((s=>{const r=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===r&&(t.removeEventListener("message",e),s(n.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:r},e),n)}))}const x=f(new Worker(new URL(t.p+t.u(14),t.b)));window.onload=async function(){const t=document.querySelector("#container"),r=[t.clientWidth/2,t.clientHeight/2];let i=!1;const c=document.querySelector("#canvas");c.style.transform=`translate(${r[0]}px,${r[1]}px)`;const l=document.querySelector("#vertices"),u=document.querySelector("#viewer"),h=document.querySelector("#viewer button"),d=document.querySelector("svg"),p=await async function(t,r){const i=await async function(t){const e=[],n=Math.trunc(t/200);for(let t=1;t<n;t++)e.push(o(t,200));const s=Math.trunc(t%200);s>0&&e.push(o(n,s));const r=await Promise.all(e),a=await Promise.all(r.map((t=>t.json()))),i=[];for(const t of a)for(const e of t.hits)i.push({largeImageURL:e.largeImageURL,webformatWidth:e.webformatWidth,webformatHeight:e.webformatHeight,webformatURL:e.webformatURL});return i}(Math.min(t,800)),c=Math.min(t-2,3),l=function(t,n){let s=new e("graph"),r=()=>s.next();return r.double=()=>r()+11102230246251565e-32*(2097152*r()|0),r.int32=()=>4294967296*s.next()|0,r.quick=r,function(t,e,n){let s=n&&n.state;s&&("object"==typeof s&&e.copy(s,e),t.state=()=>e.copy(e,{}))}(r,s,void 0),r}();function u(t){return Math.min(Math.round(l.quick()*t),t-1)}const h=new Array(t),d=new Array(t);for(let e=0;e<t;e++)d[e]=new Set,h[e]=new a(e,i[u(i.length)]);for(let e=0;e<t;e++){const n=d[e];let s=Math.round(l.quick()*c)+1;for(;n.size<s;){const s=u(t);s!==e&&(n.add(s),d[s].add(e))}}const p=u(t),m=[],f=new n(t);let g=new Set(d.map(((t,e)=>e)));g.delete(p);let w=p;do{m.push(w);for(const t of d[w])g.has(t)&&(g.delete(t),f.enqueue(t));w=f.dequeue()}while(void 0!==w);for(const t of g){const e=m[u(m.length)];m.push(t),g.delete(t);for(const e of d[t])m.push(e),g.delete(e);d[t].add(e),d[e].add(t)}f.clear(),g.clear(),g.add(p),w=p,m.splice(0,m.length);do{m.push(w);for(const t of d[w])g.has(t)||(g.add(t),f.enqueue(t));w=f.dequeue()}while(void 0!==w&&m.length<r);return new s(h,d,m,i)}(100,100),m=await new x(p.sendGraphData());await m.buildGraph(p.subGraph,400),await m.initLayout(),l.appendChild(function(t,e){const n=new DocumentFragment;for(let e=0;e<t;e++){const t=new Image(200,200);t.classList.add("vertex"),t.loading="lazy",n.appendChild(t)}return n}(p.nodes.length)),d.appendChild(function(t){const e=new DocumentFragment;for(let n=0;n<t;n++){const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.classList.add("edge"),e.appendChild(t)}return e}(p.edges.length)),await async function(){const t=await m.pos,e=p.subGraph.map((t=>p.index.get(t)));for(let n=0;n<e.length;n++){const s=e[n],r=2*s,a=t[r]-100,o=-t[r+1]-100,{id:i,imageData:c}=p.nodes[s],u=l.children[n];u.id=i+"",u.src=c.webformatURL,u.style.transform=`translate(${a}px,${o}px)`}for(let e=0;e<p.edges.length;e++){const n=d.children[e];n.style.display="block";const{u:s,v:r}=p.edges[e];console.log(p.edges[e]);const a=t[2*s],o=-t[2*s+1],i=t[2*r],c=-t[2*r+1];n.setAttribute("d",`M${a},${o} L${i},${c}`)}}(),l.addEventListener("click",(t=>{const e=t.target;if("IMG"!==e.tagName)return;const n=parseInt(e.id);u.style.display="flex",u.lastElementChild.src=p.nodes[p.index.get(n)].imageData.largeImageURL})),h.addEventListener("click",(()=>{u.style.display="none",u.lastElementChild.src=""})),t.addEventListener("mousedown",(t=>{t.target===t.currentTarget&&(i=!0)})),t.addEventListener("mousemove",(t=>{if(i){r[0]+=t.movementX,r[1]+=t.movementY;const[e,n]=r;c.style.transform=`translate(${e}px,${n}px)`}})),t.addEventListener("mouseup",(()=>{i=!1}))}})();